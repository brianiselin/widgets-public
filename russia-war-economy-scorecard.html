
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Russia War Economy Scorecard — Collapse Meter</title>
<meta name="description" content="Interactive toy model of Russia's wartime economy. Adjust sanctions, oil flows, rail volumes, and fiscal buffers to see the collapse meter move." />
<style>
  :root{
    --bg:#0b1118;--panel:#0e1624;--panel2:#0b1320;--muted:#152033;
    --text:#e7eef6;--sub:#a8b4c8;--accent:#66d1ff;
    --good:#4ade80;--warn:#fde047;--bad:#fb7185;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue",Arial}
  body{margin:0;background:var(--bg);color:var(--text)}
  .wrap{max-width:1100px;margin:0 auto;padding:18px}
  h1{font-size:clamp(22px,3.4vw,36px);margin:6px 0 6px}
  .sub{color:var(--sub)}
  .shell{background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
         border:1px solid rgba(255,255,255,.06);border-radius:16px;box-shadow:0 14px 36px rgba(0,0,0,.35)}
  .grid{display:grid;gap:16px}
  @media(min-width:980px){.grid{grid-template-columns:1.2fr .8fr}}
  .left{padding:16px;background:var(--panel2);border-radius:16px}
  .right{padding:16px;background:var(--panel);border-radius:16px;display:grid;gap:12px;grid-auto-rows:min-content}
  .row{display:flex;align-items:center;gap:10px}
  .control{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:12px;margin-bottom:10px}
  .control h4{margin:0 0 6px;font-size:14px}
  input[type=range]{width:100%}
  .val{min-width:56px;text-align:right;font-variant-numeric:tabular-nums;color:var(--accent);font-weight:700}
  .pill{padding:2px 8px;border-radius:999px;background:#0f1b2b;border:1px solid rgba(255,255,255,.18);font-size:12px;color:var(--sub)}
  .kpis{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px}
  .kpi{background:var(--panel);border:1px solid rgba(255,255,255,.09);border-radius:14px;padding:14px}
  .kpi .lbl{color:var(--sub);font-size:12px}
  .kpi .num{font-size:24px;font-weight:800;margin-top:4px}
  .meter{background:var(--panel);border:1px solid rgba(255,255,255,.09);border-radius:14px;padding:16px}
  .bar{height:16px;border-radius:10px;background:linear-gradient(90deg,var(--good),#d9f99d,#fde047,#fbbf24,var(--bad));position:relative}
  .needle{position:absolute;top:-5px;width:2px;height:26px;background:#fff;border-radius:1px;box-shadow:0 0 0 2px rgba(255,255,255,.25)}
  .legend{display:flex;justify-content:space-between;font-size:12px;color:var(--sub);margin-top:6px}
  button{background:var(--muted);border:1px solid rgba(255,255,255,.08);color:var(--text);padding:9px 12px;border-radius:10px;cursor:pointer;font-weight:700}
  button:hover{filter:brightness(1.08)}
  .toprow{display:flex;gap:10px;align-items:center;justify-content:space-between;flex-wrap:wrap;margin-bottom:10px}
  .presets{display:flex;gap:8px;flex-wrap:wrap}
  details{background:var(--panel);border:1px solid rgba(255,255,255,.09);border-radius:12px;padding:10px}
  summary{cursor:pointer;font-weight:700}
  .note{color:var(--sub);font-size:12px;line-height:1.45}
</style>
</head>
<body>
<div class="wrap">
  <div class="toprow">
    <div>
      <h1>Russia War Economy Scorecard</h1>
      <div class="sub">Adjust the knobs to test scenarios. Educational toy model — not a forecast.</div>
    </div>
    <div class="presets">
      <button id="presetBase">Base case</button>
      <button id="presetMax">Max pressure</button>
      <button id="presetLeaky">Leaky sanctions</button>
      <button id="copy">Copy scenario link</button>
    </div>
  </div>

  <div class="shell" style="padding:16px;margin-top:8px">
    <div class="grid">
      <div class="left">
        <div class="control">
          <h4>Rail freight trend (YoY %)</h4>
          <div class="row">
            <input id="rail" type="range" min="-20" max="10" value="-6" />
            <div class="val"><span id="railVal">-6</span>%</div>
          </div>
        </div>

        <div class="control">
          <h4>Sanctions severity (enforcement, designations, export controls)</h4>
          <div class="row">
            <input id="sanc" type="range" min="0" max="10" value="6" />
            <div class="val"><span id="sancVal">6</span>/10</div>
          </div>
        </div>

        <div class="control">
          <h4>Shadow fleet & evasion capacity</h4>
          <div class="row">
            <input id="shad" type="range" min="0" max="10" value="6" />
            <div class="val"><span id="shadVal">6</span>/10</div>
          </div>
        </div>

        <div class="control">
          <h4>Oil revenue hit (discounts/volumes vs pre‑war, %)</h4>
          <div class="row">
            <input id="oil" type="range" min="0" max="100" value="40" />
            <div class="val"><span id="oilVal">40</span>/100</div>
          </div>
        </div>

        <div class="control">
          <h4>Conflict intensity (manpower draw, rotation strain)</h4>
          <div class="row">
            <input id="conf" type="range" min="0" max="10" value="6" />
            <div class="val"><span id="confVal">6</span>/10</div>
          </div>
        </div>

        <div class="control">
          <h4>China/Global South support (goods/finance/backfill)</h4>
          <div class="row">
            <input id="chi" type="range" min="0" max="10" value="4" />
            <div class="val"><span id="chiVal">4</span>/10</div>
          </div>
        </div>

        <div class="control">
          <h4>National Wealth Fund liquid buffers (USD bn)</h4>
          <div class="row">
            <input id="nwf" type="range" min="0" max="300" value="120" />
            <div class="val">$<span id="nwfVal">120</span>bn</div>
          </div>
        </div>

        <div class="control">
          <h4>Repression & controls (FX, labour, media)</h4>
          <div class="row">
            <input id="rep" type="range" min="0" max="10" value="6" />
            <div class="val"><span id="repVal">6</span>/10</div>
          </div>
        </div>

        <div class="control">
          <h4>Defence spending (% of GDP)</h4>
          <div class="row">
            <input id="defSpend" type="range" min="3" max="12" value="7.2" step="0.1" />
            <div class="val"><span id="defVal">7.2</span>%</div>
          </div>
        </div>
      </div>

      <div class="right">
        <div class="kpis">
          <div class="kpi"><div class="lbl">Collapse meter</div><div class="num" id="meterLbl">—</div></div>
          <div class="kpi"><div class="lbl">Months to fiscal crunch</div><div class="num" id="months">—</div></div>
          <div class="kpi"><div class="lbl">Real GDP (%, y/y)</div><div class="num" id="gdp">—</div></div>
          <div class="kpi"><div class="lbl">CPI inflation (%, y/y)</div><div class="num" id="cpi">—</div></div>
          <div class="kpi"><div class="lbl">Industrial output (%, y/y)</div><div class="num" id="ind">—</div></div>
          <div class="kpi"><div class="lbl">Composite score</div><div class="num" id="score">—</div></div>
        </div>

        <div class="meter">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
            <div>Collapse bar</div>
            <div id="level" class="sub">—</div>
          </div>
          <div class="bar"><div class="needle" id="needle" style="left:0%"></div></div>
          <div class="legend"><span>Resilient</span><span>Stressed</span><span>Fragile</span><span>Failing</span></div>
        </div>

        <details>
          <summary>Model notes</summary>
          <div class="note">
            Weights are illustrative. Oil revenue loss and sanctions drive most movement; shadow fleet blunts oil sanctions;
            rail tracks real activity; buffers and repression slow the slide. <b>Defence spending</b> is anchored to a
            7.2% of GDP baseline. Moving above it now has a <i>modest</i> additional effect (shorter runway, slightly weaker GDP,
            slightly higher CPI, minor drag on industry) to avoid double-counting with sanctions and oil shocks.
          </div>
        </details>
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const inputs = {
    rail: $('rail'), sanc: $('sanc'), shad: $('shad'), oil: $('oil'),
    conf: $('conf'), chi: $('chi'), nwf: $('nwf'), rep: $('rep'), defSpend: $('defSpend')
  };
  const outs = {
    railVal:$('railVal'), sancVal:$('sancVal'), shadVal:$('shadVal'), oilVal:$('oilVal'),
    confVal:$('confVal'), chiVal:$('chiVal'), nwfVal:$('nwfVal'), repVal:$('repVal'), defVal:$('defVal'),
    months:$('months'), gdp:$('gdp'), cpi:$('cpi'), ind:$('ind'), score:$('score'), needle:$('needle'), level:$('level'), meterLbl:$('meterLbl')
  };

  function clamp(x,a,b){ return Math.max(a, Math.min(b,x)); }

  function compute(){
    const rail = +inputs.rail.value;
    const sanc = +inputs.sanc.value/10;      // 0..1
    const shad = +inputs.shad.value/10;      // 0..1
    const oil  = +inputs.oil.value;          // 0..100 (hit)
    const conf = +inputs.conf.value/10;
    const chi  = +inputs.chi.value/10;
    const nwf  = +inputs.nwf.value;          // $bn
    const rep  = +inputs.rep.value/10;
    const def  = +inputs.defSpend.value;     // % of GDP
    const defGap = def - 7.2;                // PATCH: deviation from baseline

    // --- Months to crunch (higher better) ---
    let months = 8
      - (oil/100)*4.0
      - (sanc*3.0)
      - (shad*1.5)
      - (conf*1.5)
      + (chi*2.0)
      + (nwf/180)*1.8
      + (rep*0.8)
      // PATCH: defence spend above baseline shortens runway, below lengthens slightly
      + (defGap < 0 ? Math.abs(defGap)*0.25 : -defGap*0.40);
    months = clamp(Math.round(months*10)/10, 0.5, 18);

    // --- Real GDP y/y ---
    let gdp = -4
      - (oil/100)*5.0
      - (sanc*3.5)
      - (shad*1.2)
      - (Math.max(0,-rail)/20)*2.0
      + (chi*2.5)
      // PATCH: small crowding-out
      - (defGap*0.25);
    gdp = clamp(Math.round(gdp*10)/10, -25, 2);

    // --- CPI y/y ---
    let cpi = 11
      + (oil/100)*6.0
      + (sanc*4.0)
      - (rep*3.0)
      // PATCH: only add when defence is above baseline
      + (Math.max(0, defGap)*0.30);
    cpi = clamp(Math.round(cpi*10)/10, 6, 30);

    // --- Industrial output y/y ---
    let ind = -8
      - (sanc*10)
      - (shad*6)
      - (Math.max(0,-rail)/20)*3
      + (chi*4)
      // PATCH: mild extra bottleneck effect
      - (defGap*0.30);
    ind = clamp(Math.round(ind*10)/10, -50, -2);

    // Composite collapse score (0=ok, 100=collapse)
    let score = 0;
    score += (18 - months) * (100/18) * 0.30;           // runway
    score += clamp((-gdp)/25*100,0,100) * 0.25;         // GDP contraction
    score += clamp((cpi-6)/(30-6)*100,0,100) * 0.20;    // inflation
    score += clamp((-ind)/50*100,0,100) * 0.25;         // industry
    score = clamp(Math.round(score), 0, 100);

    let band = 'Resilient';
    if(score>=25) band='Stressed';
    if(score>=55) band='Fragile';
    if(score>=80) band='Failing';

    outs.months.textContent = months.toFixed(1);
    outs.gdp.textContent = gdp.toFixed(1);
    outs.cpi.textContent = cpi.toFixed(1);
    outs.ind.textContent = ind.toFixed(1);
    outs.score.textContent = score + '/100';
    outs.needle.style.left = score + '%';
    outs.level.textContent = band;
    outs.meterLbl.textContent = band;

    // display slider values
    outs.railVal.textContent = rail;
    outs.sancVal.textContent = (sanc*10).toFixed(0);
    outs.shadVal.textContent = (shad*10).toFixed(0);
    outs.oilVal.textContent = oil;
    outs.confVal.textContent = (conf*10).toFixed(0);
    outs.chiVal.textContent = (chi*10).toFixed(0);
    outs.nwfVal.textContent = nwf.toFixed(0);
    outs.repVal.textContent = (rep*10).toFixed(0);
    outs.defVal.textContent = def.toFixed(1);

    // shareable URL state
    const parts=[rail, (sanc*10).toFixed(0), (shad*10).toFixed(0), oil, (conf*10).toFixed(0), (chi*10).toFixed(0), nwf.toFixed(0), (rep*10).toFixed(0), def.toFixed(1)];
    history.replaceState(null,'','#'+parts.join(','));
  }

  function loadHash(){
    if(location.hash.length>1){
      const p = location.hash.substring(1).split(',');
      if(p.length===9){
        [inputs.rail.value, inputs.sanc.value, inputs.shad.value, inputs.oil.value, inputs.conf.value, inputs.chi.value, inputs.nwf.value, inputs.rep.value, inputs.defSpend.value] = p;
      }
    }
    compute();
  }

  document.getElementById('presetBase').addEventListener('click',()=>{
    inputs.rail.value=-6; inputs.sanc.value=6; inputs.shad.value=6; inputs.oil.value=40;
    inputs.conf.value=6; inputs.chi.value=4; inputs.nwf.value=120; inputs.rep.value=6; inputs.defSpend.value=7.2;
    compute();
  });
  document.getElementById('presetMax').addEventListener('click',()=>{
    inputs.rail.value=-15; inputs.sanc.value=9; inputs.shad.value=3; inputs.oil.value=70;
    inputs.conf.value=8; inputs.chi.value=2; inputs.nwf.value=60; inputs.rep.value=5; inputs.defSpend.value=9.5;
    compute();
  });
  document.getElementById('presetLeaky').addEventListener('click',()=>{
    inputs.rail.value=-3; inputs.sanc.value=4; inputs.shad.value=8; inputs.oil.value=25;
    inputs.conf.value=5; inputs.chi.value=6; inputs.nwf.value=160; inputs.rep.value=7; inputs.defSpend.value=6.5;
    compute();
  });
  document.getElementById('copy').addEventListener('click',()=>{
    navigator.clipboard.writeText(location.href).then(()=>{
      const btn=document.getElementById('copy');const t=btn.textContent;btn.textContent='Copied!';setTimeout(()=>btn.textContent=t,1100);
    });
  });

  Object.values(inputs).forEach(el=> el.addEventListener('input', compute));
  loadHash();
})();
</script>
</body>
</html>
