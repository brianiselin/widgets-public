<!DOCTYPE html>
<html lang="en">
<head>

  <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "22466d27b8c14ef98293d50b38526660"}'></script><!-- End Cloudflare Web Analytics --><meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EU–China Relations: State of Play Dashboard (Dynamic, Locked)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<!-- Cloudflare Web Analytics --><script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "22466d27b8c14ef98293d50b38526660"}'></script><!-- End Cloudflare Web Analytics -->
<style>
  :root{
    --bg:#0B1020;
    --card:#121a35;
    --ink:#f4f8ff;
    --muted:#9db0ff;
    --accent:#6cf;
    --accent2:#ff4d9d;
    --accent3:#39e29d;
    --accent4:#ffd166;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 800px at 10% -10%, #1b2a6a33, transparent),
                radial-gradient(1200px 800px at 110% 10%, #6fffff22, transparent),
                var(--bg);
    color:var(--ink);
    font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
  }
  header{
    padding:28px 20px 8px;
    display:flex;align-items:center;justify-content:space-between;gap:16px;
    position:sticky;top:0;background:linear-gradient(180deg, rgba(11,16,32,0.9), rgba(11,16,32,0.5), transparent);
    backdrop-filter: blur(8px);
    z-index:10;
  }
  .brand{display:flex;align-items:center;gap:14px}
  .blob{
    width:36px;height:36px;border-radius:14px;
    background: conic-gradient(from 210deg, var(--accent), var(--accent2), var(--accent3), var(--accent4), var(--accent));
    box-shadow: 0 0 24px #6cffff88, inset 0 0 24px #ffffff11;
  }
  .title{font-weight:800;letter-spacing:.2px;font-size:1.1rem;line-height:1.1}
  .subtitle{font-size:.9rem;color:var(--muted)}
  .grid{
    display:grid;gap:16px;padding:16px;grid-template-columns:repeat(12,1fr);max-width:1400px;margin:0 auto;
  }
  .card{
    background: linear-gradient(180deg, #121a35, #0f1730);
    border:1px solid #1e2b57;
    border-radius:16px;padding:16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.25), inset 0 1px 0 rgba(255,255,255,0.03);
  }
  .card h3{margin:0 0 10px;font-size:1rem;font-weight:800;letter-spacing:.3px}
  .kpis{display:grid;grid-template-columns:repeat(12,1fr);gap:16px}
  .kpi{
    grid-column: span 4;
    padding:16px;border-radius:14px;background:
      radial-gradient(600px 300px at 0% 0%, #6cffff14, transparent),
      linear-gradient(180deg, #121a35, #0e162f);
    border:1px solid #213066;
  }
  .kpi .label{font-size:.8rem;color:var(--muted);font-weight:600}
  .kpi .value{font-size:1.8rem;font-weight:800;margin-top:6px}
  .span-6{grid-column:span 6}
  .span-4{grid-column:span 4}
  .span-8{grid-column:span 8}
  .span-12{grid-column:span 12}
  .pill{
    display:inline-flex;align-items:center;gap:8px;
    border:1px solid #27408b;border-radius:999px;padding:6px 10px;font-size:.8rem;color:#bed0ff;
    background:linear-gradient(180deg,#16204a,#0f1732);
  }
  .row{display:flex;gap:10px;flex-wrap:wrap}
  a{color:#a6d0ff;text-decoration:underline}
  footer{max-width:1400px;margin:20px auto 60px;padding:0 16px;color:#bcd2ff99}
  .small{font-size:.85rem}
  .legend-dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px}
  .note{font-size:.8rem;color:#cfe2ffaa}
  .btn{
      appearance:none;border:none;background:linear-gradient(180deg,#2b6fff,#1b57e6);
      color:white;padding:8px 12px;border-radius:10px;font-weight:700;cursor:pointer;
      box-shadow: 0 6px 20px rgba(43,111,255,.4);
  }
  @media (max-width: 900px){
    .kpi{grid-column:span 12}
    .span-6,.span-4,.span-8{grid-column:span 12}
  }
</style>
</head>
<body>
<header>
  <div class="brand">
    <div class="blob"></div>
    <div>
      <div class="title">EU–China Relations — State of Play</div>
      <div class="subtitle">Dynamic indicators from your repo JSON (public view is display‑only)</div>
    </div>
  </div>
  <div class="row">
    <span class="pill">Updated: <span id="updatedAt">—</span></span>
    <button class="btn" id="exportBtn" title="Download a snapshot of this dashboard as a PNG">Export PNG</button>
  </div>
</header>

<main class="grid">
  <section class="card span-12">
    <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:10px">
      <h3>2024 Snapshot (Goods Trade)</h3>
      <span class="pill"><span class="legend-dot" style="background:var(--accent)"></span>Eurostat 2024</span>
    </div>
    <div class="kpis" id="kpiStrip"></div>
    <div class="note" style="margin-top:8px">Figures refer to EU external trade in goods with China in calendar year 2024 (Eurostat).</div>
  </section>

  <section class="card span-6">
    <h3>EU Goods Trade with China (2024)</h3>
    <canvas id="tradePie" height="200"></canvas>
    <div class="row" style="margin-top:10px">
      <span class="pill"><span class="legend-dot" style="background:var(--accent3)"></span>Exports</span>
      <span class="pill"><span class="legend-dot" style="background:var(--accent2)"></span>Imports</span>
      <span class="pill"><span class="legend-dot" style="background:var(--accent4)"></span>Deficit</span>
    </div>
    <div class="note" style="margin-top:8px">Deficit = Imports − Exports</div>
  </section>

  <section class="card span-6">
    <h3>China’s Share of EU Extra‑EU Imports (2024)</h3>
    <canvas id="shareGauge" height="200"></canvas>
    <div class="note" style="margin-top:8px">Share of all extra‑EU imports accounted for by China.</div>
  </section>

  <section class="card span-8">
    <div class="row" style="justify-content:space-between;align-items:center;">
      <h3>Who supplies EU high‑tech imports? (2024)</h3>
      <span class="pill">Eurostat “High‑tech trade”</span>
    </div>
    <canvas id="highTechBar" height="240"></canvas>
    <div class="note">Supplier shares of EU high‑tech imports.</div>
  </section>

  <section class="card span-4">
    <h3>Critical Raw Materials exposure</h3>
    <canvas id="crmDonut" height="220"></canvas>
    <div class="note">Dependence on China‑linked supply for rare‑earth magnets and selected inputs.</div>
  </section>

  <section class="card span-6">
    <h3>Policy Heat: Trade Defence & Screening</h3>
    <canvas id="policyGauge" height="220"></canvas>
    <div class="note">Illustrative index blending countervailing duty maxima and investment screening activity.</div>
  </section>

  <section class="card span-6">
    <div class="row" style="justify-content:space-between;align-items:center;">
      <h3>Chinese FDI into Europe</h3>
      <span class="pill">Rhodium Group / MERICS</span>
    </div>
    <canvas id="fdiLine" height="220"></canvas>
    <div class="note">FDI flows rebased to €bn.</div>
  </section>
</main>

<footer>
  <div class="small">
    <strong>Data feed:</strong> By default this file fetches <code>./data/eu-china.json</code>. You can override with a query string:<br>
    <code>?data=https://YOUR-DOMAIN/path/eu-china.json</code><br>
    <br>
    <strong>Expected JSON schema (example):</strong>
<pre style="white-space:pre-wrap;color:#cfe2ff;background:#0b1228;border:1px solid #223266;border-radius:10px;padding:10px">
{
  "meta": { "updatedAt": "2025-09-25" },
  "trade2024": { "exportsBn": 213.3, "importsBn": 517.8, "importSharePct": 21.3 },
  "highTechSuppliers2024": [
    {"name":"China","share":30}, {"name":"United States","share":23},
    {"name":"Switzerland","share":6}, {"name":"Taiwan","share":6},
    {"name":"Vietnam","share":5}, {"name":"United Kingdom","share":4}
  ],
  "crm": { "magnetsDependencePct": 98, "magnesiumFromChina": 1, "galliumFromChina": 1 },
  "policy": { "evDutyMaxPct": 35.3, "screeningIndex": 65 },
  "fdi": { "years":[2019,2020,2021,2022,2023,2024], "valuesBn":[11.7,6.5,10.6,7.9,6.8,10.0] }
}
</pre>
  </div>
</footer>

<script>
// ---------- DEFAULT (FALLBACK) DATA ----------
const DEFAULT_DATA = {
  meta: { updatedAt: new Date().toISOString().slice(0,10) },
  trade2024: { exportsBn: 213.3, importsBn: 517.8, importSharePct: 21.3 },
  highTechSuppliers2024: [
    { name: "China", share: 30 },
    { name: "United States", share: 23 },
    { name: "Switzerland", share: 6 },
    { name: "Taiwan", share: 6 },
    { name: "Vietnam", share: 5 },
    { name: "United Kingdom", share: 4 }
  ],
  crm: { magnetsDependencePct: 98, magnesiumFromChina: 1, galliumFromChina: 1 },
  policy: { evDutyMaxPct: 35.3, screeningIndex: 65 },
  fdi: { years: [2019, 2020, 2021, 2022, 2023, 2024], valuesBn: [11.7, 6.5, 10.6, 7.9, 6.8, 10.0] }
};

// ---------- LOAD DATA FROM JSON ----------
async function loadData() {
  try {
    const u = new URL(window.location.href);
    const override = u.searchParams.get("data");
    const dataUrl = override || new URL("./data/eu-china.json", window.location.href).toString();
    const res = await fetch(dataUrl, { cache: "no-cache" });
    if (!res.ok) throw new Error("HTTP " + res.status);
    const obj = await res.json();
    return obj;
  } catch (e) {
    console.warn("Using fallback DEFAULT_DATA:", e.message || e);
    return DEFAULT_DATA;
  }
}

// ---------- RENDER ----------
const fmt = (n) => new Intl.NumberFormat(undefined,{maximumFractionDigits:1}).format(n);
const euro = (n) => "€" + fmt(n) + "bn";

let DATA;

loadData().then(obj=>{
  DATA = obj || DEFAULT_DATA;
  const updated = (DATA.meta && DATA.meta.updatedAt) ? DATA.meta.updatedAt : new Date().toISOString().slice(0,10);
  document.getElementById('updatedAt').textContent = updated;

  // KPIs
  const kpiHost = document.getElementById('kpiStrip');
  const deficit = DATA.trade2024.importsBn - DATA.trade2024.exportsBn;
  const kpis = [
    { label: "Exports to China (goods, 2024)", value: euro(DATA.trade2024.exportsBn) },
    { label: "Imports from China (goods, 2024)", value: euro(DATA.trade2024.importsBn) },
    { label: "Trade Balance (deficit, 2024)", value: "–" + euro(deficit) },
    { label: "China share of EU imports", value: DATA.trade2024.importSharePct + "%" },
    { label: "High‑tech imports from China", value: DATA.highTechSuppliers2024[0].share + "%" },
    { label: "Chinese FDI into EU+UK (2024)", value: euro(DATA.fdi.valuesBn[DATA.fdi.valuesBn.length-1]) }
  ];
  kpis.forEach((k)=>{
    const el = document.createElement('div');
    el.className = 'kpi';
    el.innerHTML = `<div class="label">${k.label}</div><div class="value">${k.value}</div>`;
    kpiHost.appendChild(el);
  });

  // Charts
  new Chart(document.getElementById('tradePie'), {
    type:'doughnut',
    data:{
      labels:['Exports','Imports','Deficit'],
      datasets:[{
        data:[DATA.trade2024.exportsBn, DATA.trade2024.importsBn, deficit],
        backgroundColor:['#39e29d','#ff4d9d','#ffd16622'],
        hoverOffset:8,
        borderWidth:0
      }]
    },
    options:{ plugins:{ legend:{ display:false } }, cutout:'60%' }
  });

  const share = DATA.trade2024.importSharePct;
  new Chart(document.getElementById('shareGauge'), {
    type:'doughnut',
    data:{ labels:['China share','Other'], datasets:[{ data:[share, 100-share], backgroundColor:['#6cf','#273d82'], borderWidth:0 }] },
    options:{ rotation:-90, circumference:180, plugins:{ legend:{ display:false }, tooltip:{enabled:false} } }
  });

  const ht = DATA.highTechSuppliers2024;
  new Chart(document.getElementById('highTechBar'), {
    type:'bar',
    data:{ labels: ht.map(d=>d.name), datasets:[{ data: ht.map(d=>d.share), backgroundColor:['#6cf','#5de0c1','#ffd166','#ff4d9d','#a88cff','#7fe36e'], borderWidth:0, borderRadius:8 }] },
    options:{
      plugins:{ legend:{ display:false } },
      scales:{ y:{ grid:{color:'#28407a55'}, ticks:{ color:'#cfe2ff' }, suggestedMax:40 }, x:{ ticks:{ color:'#cfe2ff' } } }
    }
  });

  new Chart(document.getElementById('crmDonut'), {
    type:'doughnut',
    data:{ labels:['Rare‑earth magnets from CN‑linked supply','Other'], datasets:[{ data:[DATA.crm.magnetsDependencePct, 100-DATA.crm.magnetsDependencePct], backgroundColor:['#ff4d9d','#253a7a'], borderWidth:0 }] },
    options:{ plugins:{ legend:{ display:false } }, cutout:'65%' }
  });

  const policyScore = Math.min(100, Math.round( (DATA.policy.evDutyMaxPct/40)*50 + (DATA.policy.screeningIndex/100)*50 ));
  new Chart(document.getElementById('policyGauge'), {
    type:'doughnut',
    data:{ labels:['Policy heat','Headroom'], datasets:[{ data:[policyScore, 100-policyScore], backgroundColor:['#ffd166','#243b7a'], borderWidth:0 }] },
    options:{ rotation:-90, circumference:180, plugins:{legend:{display:false}, tooltip:{enabled:false}} }
  });

  new Chart(document.getElementById('fdiLine'), {
    type:'line',
    data:{ labels: DATA.fdi.years, datasets:[{ data: DATA.fdi.valuesBn, tension:.35, fill:true, backgroundColor:'#6cffff22', borderColor:'#6cf', borderWidth:2, pointRadius:3 }] },
    options:{ plugins:{ legend:{ display:false } }, scales:{ y:{ grid:{color:'#28407a55'}, ticks:{ color:'#cfe2ff' }}, x:{ ticks:{ color:'#cfe2ff' }} } }
  });
});

// Export PNG via html2canvas
const exportBtn = document.getElementById('exportBtn');
(function addExporter(){
  const s = document.createElement('script');
  s.src = "https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js";
  s.onload = () => {
    exportBtn.addEventListener('click', async ()=>{
      const el = document.body;
      const canvas = await html2canvas(el,{backgroundColor:'#0B1020',scale:2});
      const link = document.createElement('a');
      link.download = 'eu-china-dashboard.png';
      link.href = canvas.toDataURL();
      link.click();
    });
  };
  document.head.appendChild(s);
})();
</script>
</body>
</html>
