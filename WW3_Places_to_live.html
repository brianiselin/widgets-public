<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WW3 Happiness Index â€” Top 10 & Worst 10 | Iselin Group</title>
  <style>
    :root{
      --bg:#0b1220; --panel:#121a2b; --ink:#e8edf5; --muted:#9fb0cc;
      --accent:#f4b740; --ok:#37c977; --warn:#ff9f1c; --bad:#ef476f; --grid:rgba(255,255,255,.10);
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:
      radial-gradient(1200px 600px at 70% -10%, rgba(255,255,255,.06), transparent),
      var(--bg); color:var(--ink); font:15px/1.55 Inter, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;}
    /* Top bar */
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      padding:10px 16px; border-bottom:1px solid rgba(255,255,255,.2);
      background:linear-gradient(180deg, rgba(0,0,0,.82), rgba(0,0,0,.62));
    }
    .topbar .left{font-weight:600; font-size:13px}
    .topbar .center{font-variant:small-caps; color:var(--muted); font-size:12px}
    .topbar img{height:28px; width:auto; border-radius:4px}

    /* Shell */
    .wrap{max-width:1100px; margin:18px auto 64px; padding:0 16px}
    h1{margin:0 0 6px; font-size:28px; letter-spacing:.2px}
    .subtitle{color:var(--muted); margin-bottom:16px}
    .card{
      background:var(--panel); border:1px solid var(--grid); border-radius:16px; padding:16px;
      box-shadow:0 12px 32px rgba(0,0,0,.28);
    }
    .controls{display:grid; grid-template-columns:1fr 1fr; gap:12px; margin:14px 0}
    @media (max-width:860px){ .controls{grid-template-columns:1fr} }

    label{display:block; color:var(--muted); font-size:13px; margin-bottom:6px}
    select, input[type="range"], input[type="checkbox"]{width:100%}
    select{padding:10px 12px; background:#0e1629; color:var(--ink); border:1px solid var(--grid); border-radius:12px}
    .range-wrap{padding:10px 12px; border:1px solid var(--grid); border-radius:12px; background:#0e1629}
    .hint{font-size:12px; color:var(--muted)}
    details.policy{margin-top:8px}
    details.policy summary{cursor:pointer; color:var(--muted)}
    .policy-grid{display:grid; grid-template-columns:repeat(2,minmax(0,1fr)); gap:10px; margin-top:10px}
    @media (max-width:680px){ .policy-grid{grid-template-columns:1fr} }
    .policy-grid label{display:flex; gap:10px; align-items:center; margin:0; color:var(--ink); font-size:14px}

    /* Rankings */
    .grid{display:grid; grid-template-columns:1fr 1fr; gap:16px; margin-top:16px}
    @media (max-width:900px){ .grid{grid-template-columns:1fr} }
    .panel{background:var(--panel); border:1px solid var(--grid); border-radius:16px; overflow:hidden}
    .panel h2{margin:0; padding:12px 14px; font-size:18px; border-bottom:1px solid var(--grid)}
    .panel.top h2{color:var(--ok)}
    .panel.bot h2{color:var(--bad)}
    .list{padding:10px 8px}
    .row{display:flex; justify-content:space-between; align-items:center; gap:8px; padding:10px 10px; border-radius:10px}
    .row:nth-child(odd){background:rgba(255,255,255,.02)}
    .row:hover{background:rgba(255,255,255,.05)}
    .lefty{display:flex; gap:10px; align-items:center; min-width:0}
    .rank{width:32px; text-align:right; font-feature-settings:"tnum" 1; color:var(--muted)}
    .name{font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .righty{text-align:right; min-width:240px}
    .score{font-weight:700; color:var(--accent)}
    .mini{font-size:12px; color:var(--muted)}
    .bar{height:6px; background:#0e1629; border:1px solid var(--grid); border-radius:999px; overflow:hidden; margin-top:4px}
    .bar>span{display:block; height:100%; background:linear-gradient(90deg, var(--bad), var(--warn), var(--ok))}
    .foot{margin-top:16px; color:var(--muted); font-size:13px}
    .copyright{margin-top:26px; color:var(--muted); font-size:12px; text-align:center}
    .btn{padding:8px 10px; border:1px solid var(--grid); background:#0e1629; color:var(--ink); border-radius:10px; cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .toolbar{display:flex; gap:8px; align-items:center; margin-top:8px}
  </style>
</head>
<body>
  <!-- Top branding -->
  <div class="topbar">
    <div class="left">Iselin Group â€” Strategic Consulting</div>
    <div class="center">iselingroup.com â€¢ brian.iselin(@)iselingroup.com</div>
    <img src="https://brianiselin.github.io/widgets-public/Iselin_Group_Logo_1024_x.jpg" alt="Iselin Group">
  </div>

  <div class="wrap">
    <h1>WW3 Happiness Index</h1>
    <p class="subtitle">Top 10 and Worst 10 places to live if WW3 happens, combining survival probability with life satisfaction. A dark joke with a serious model.</p>

    <!-- Controls -->
    <div class="card">
      <div class="controls">
        <div>
          <label for="method">Blend method (choose how we combine Survival & Happiness)</label>
          <select id="method">
            <option value="geo">Geometric mean (balanced & penalises weak links)</option>
            <option value="harm">Harmonic mean (harshest on weak links)</option>
            <option value="lin">Linear mean (simplest & transparent)</option>
          </select>
        </div>
        <div>
          <label>Weight towards Survival: <span id="wLabel">60%</span></label>
          <div class="range-wrap">
            <input id="weight" type="range" min="0" max="100" value="60" />
            <div class="hint">Happiness weight auto-adjusts to <span id="hLabel">40%</span>.</div>
          </div>
        </div>
      </div>

      <details class="policy">
        <summary>Policy switches (apply real-world adjustments)</summary>
        <div class="policy-grid">
          <label><input type="checkbox" id="penCombat" checked> Penalty for active combatants (âˆ’25%)</label>
          <label><input type="checkbox" id="penTriad" checked> Penalty for nuclear triad / primary target hubs (âˆ’20%)</label>
          <label><input type="checkbox" id="bonusIsland" checked> Bonus for remote islands (+5%)</label>
          <label><input type="checkbox" id="bonusRenew" checked> Bonus for â‰¥70% renewables (+5%)</label>
        </div>
        <div class="toolbar">
          <button class="btn" id="reset">Reset defaults</button>
          <span class="hint">These adjust Survival before blending with Happiness.</span>
        </div>
      </details>
    </div>

    <!-- Rankings -->
    <div class="grid">
      <div class="panel top">
        <h2>ğŸ† Top 10 â€” â€œWinnersâ€</h2>
        <div class="list" id="topList"></div>
      </div>
      <div class="panel bot">
        <h2>ğŸ’€ Worst 10 â€” â€œLosersâ€</h2>
        <div class="list" id="botList"></div>
      </div>
    </div>

    <p class="foot">Method sketch: survival i<div class="methodology">
    <h3>âš ï¸ Methodology (Sort Of)</h3>
    <p>
        We've built a half-serious, half-sardonic "WW3 Happiness Index" by combining each country's
        estimated <strong>nuclear war survival probability</strong> (remoteness, target profile, food and
        energy resilience) with its <strong>2024 life satisfaction score</strong>. Survival is first adjusted
        with simple policy switches: penalties if you're an active combatant, a nuclear triad state, or a
        primary target hub; small bonuses if you're a remote island or run mostly on renewables. Then we
        blend survival and happiness on the same 0â€“100 scale using a weighted mean (60% Survival, 40% Happiness),
        with a default <strong>geometric mean</strong> that gently punishes lopsided countries. You can switch to
        a harsher <strong>harmonic mean</strong> or a simple <strong>linear mean</strong> if you want to see how
        your favourite moves when the maths gets less forgiving. Higher scores mean places that are both
        more likely to survive and more bearable to live in when the sirens sound.
    </p>
</div>
    <p class="copyright">Â© Iselin Group. â€œWW3 Happiness Index.â€ UI & model logic are proprietary; all rights reserved.</p>
  </div>

  <script>
    // -------- Data (survival %, happiness on 0â€“10 scale) ----------
    // NOTE: Add or tune entries here. Meta flags feed policy adjustments.
    const COUNTRIES = [
      {name:"Iceland",        survival:97.3, happiness:7.53, meta:{remoteIsland:true, renewablesShare:85}},
      {name:"Bhutan",         survival:95.5, happiness:7.59, meta:{}},
      {name:"New Zealand",    survival:87.0, happiness:7.03, meta:{remoteIsland:true, renewablesShare:82}},
      {name:"Uruguay",        survival:81.0, happiness:6.61, meta:{renewablesShare:90}},
      {name:"Australia",      survival:83.4, happiness:7.06, meta:{remoteIsland:true, renewablesShare:30}},
      {name:"Costa Rica",     survival:80.0, happiness:6.96, meta:{renewablesShare:98}},
      {name:"Indonesia",      survival:63.0, happiness:5.57, meta:{remoteIsland:false, renewablesShare:15}},
      {name:"Chile",          survival:71.0, happiness:6.36, meta:{renewablesShare:55}},
      {name:"Brazil",         survival:68.0, happiness:6.27, meta:{renewablesShare:45}},
      {name:"Argentina",      survival:65.0, happiness:6.19, meta:{renewablesShare:30}},

      // Likely bottom candidates from the user's list:
      {name:"Afghanistan",    survival:4.0,  happiness:1.72, meta:{activeCombatant:true}},
      {name:"Ukraine",        survival:13.0, happiness:4.87, meta:{activeCombatant:true}},
      {name:"Russia",         survival:16.0, happiness:5.79, meta:{activeCombatant:true, nuclearTriad:true, primaryTargetHub:true}},
      {name:"United States",  survival:20.0, happiness:6.73, meta:{nuclearTriad:true, primaryTargetHub:true}},
      {name:"Israel",         survival:23.0, happiness:7.34, meta:{activeCombatant:true, primaryTargetHub:true}},
      {name:"United Kingdom", survival:24.0, happiness:6.75, meta:{primaryTargetHub:true}},
      {name:"Germany",        survival:25.0, happiness:6.72, meta:{primaryTargetHub:true}},
      {name:"France",         survival:25.0, happiness:6.61, meta:{primaryTargetHub:true}},
      {name:"China",          survival:23.0, happiness:5.97, meta:{primaryTargetHub:true, nuclearTriad:true}},
      {name:"North Korea",    survival:12.5, happiness:3.00, meta:{activeCombatant:true, primaryTargetHub:true, nuclearTriad:false}}
    ];

    // -------- Controls ----------
    const els = {
      method: document.getElementById('method'),
      weight: document.getElementById('weight'),
      wLabel: document.getElementById('wLabel'),
      hLabel: document.getElementById('hLabel'),
      penCombat: document.getElementById('penCombat'),
      penTriad: document.getElementById('penTriad'),
      bonusIsland: document.getElementById('bonusIsland'),
      bonusRenew: document.getElementById('bonusRenew'),
      reset: document.getElementById('reset'),
      topList: document.getElementById('topList'),
      botList: document.getElementById('botList')
    };

    // -------- Maths helpers ----------
    function clamp(x,min,max){ return Math.max(min, Math.min(max, x)); }

    function applyPolicyAdjustments(S, meta, switches){
      let adj = S;
      if (switches.penCombat && meta.activeCombatant) adj *= 0.75;  // -25%
      if (switches.penTriad  && (meta.nuclearTriad || meta.primaryTargetHub)) adj *= 0.80; // -20%
      let bonus = 1;
      if (switches.bonusIsland && meta.remoteIsland) bonus *= 1.05; // +5%
      if (switches.bonusRenew  && (meta.renewablesShare||0) >= 70) bonus *= 1.05; // +5%
      adj *= bonus;

      return clamp(adj, 0, 100);
    }

    function geoMean(S, H, w){ // geometric mean on 0..100 scales
      // Avoid log(0) by flooring at tiny epsilon
      const s = Math.max(S, 1e-6), h = Math.max(H, 1e-6);
      return Math.pow(s, w) * Math.pow(h, 1-w);
    }
    function harmMean(S, H, w){
      const eps = 1e-9;
      return 1 / ((w / (S + eps)) + ((1 - w) / (H + eps)));
    }
    function linMean(S, H, w){
      return w*S + (1-w)*H;
    }

    function computeIndex(row, method, w, switches){
      // Normalise inputs: survival 0â€“100, happiness (0â€“10) scaled to 0â€“100
      const S0 = clamp(row.survival, 0, 100);
      const H0 = clamp(row.happiness * 10, 0, 100);

      // Apply policy adjustments to Survival only
      const Sadj = applyPolicyAdjustments(S0, row.meta || {}, switches);

      let idx;
      if (method === 'harm') idx = harmMean(Sadj, H0, w);
      else if (method === 'lin') idx = linMean(Sadj, H0, w);
      else idx = geoMean(Sadj, H0, w); // default

      return { Sadj, H0, idx };
    }

    // -------- Rendering ----------
    function fmt(n,d=2){ return Number(n).toFixed(d); }

    function render(){
      const w = Number(els.weight.value)/100;
      const wH = 1 - w;
      els.wLabel.textContent = Math.round(w*100) + '%';
      els.hLabel.textContent = Math.round(wH*100) + '%';

      const switches = {
        penCombat: els.penCombat.checked,
        penTriad: els.penTriad.checked,
        bonusIsland: els.bonusIsland.checked,
        bonusRenew: els.bonusRenew.checked
      };
      const method = els.method.value;

      // Compute and rank
      const ranked = COUNTRIES.map(c=>{
        const {Sadj, H0, idx} = computeIndex(c, method, w, switches);
        return {...c, survivalAdj:Sadj, happiness100:H0, index:idx};
      }).sort((a,b)=> b.index - a.index)
        .map((r,i)=> ({...r, rank: i+1}));

      // Top 10
      const top10 = ranked.slice(0,10);
      // Worst 10 (overall ranks at the bottom)
      const bot10 = ranked.slice(-10).reverse();

      els.topList.innerHTML = top10.map(r => rowHTML(r)).join('');
      els.botList.innerHTML = bot10.map(r => rowHTML(r)).join('');
    }

    function rowHTML(r){
      return `
        <div class="row">
          <div class="lefty">
            <div class="rank">#${r.rank}</div>
            <div class="name">${r.name}</div>
          </div>
          <div class="righty">
            <div class="score">${fmt(r.index)}</div>
            <div class="mini">
              Survival: ${fmt(r.survivalAdj,1)}% &nbsp;|&nbsp; Happiness: ${fmt(r.happiness,2)}
              <div class="bar" aria-hidden="true"><span style="width:${r.index}%;"></span></div>
            </div>
          </div>
        </div>
      `;
    }

    // Allow resetting switches/weights to defaults
    els.reset.addEventListener('click', ()=>{
      els.method.value = 'geo';
      els.weight.value = 60;
      els.penCombat.checked = true;
      els.penTriad.checked = true;
      els.bonusIsland.checked = true;
      els.bonusRenew.checked = true;
      render();
    });

    ['input','change'].forEach(evt=>{
      els.method.addEventListener(evt, render);
      els.weight.addEventListener(evt, render);
      els.penCombat.addEventListener(evt, render);
      els.penTriad.addEventListener(evt, render);
      els.bonusIsland.addEventListener(evt, render);
      els.bonusRenew.addEventListener(evt, render);
    });

    // Expose happiness as the original 0â€“10 for the label
    Object.defineProperty(Object.prototype, 'happiness', {
      get(){ return this.happiness100 ? this.happiness100/10 : (this._happiness || 0); },
      set(v){ this._happiness = v; }
    });

    // Initial render
    render();
  </script>
</body>
</html>
